<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workshop Project Manager</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #e5e7eb; padding: 20px; color: #1f2937; }
        .project-header { max-width: 1100px; margin: 0 auto 20px; display: flex; justify-content: space-between; align-items: center; }
        .board-container { max-width: 1100px; margin: 0 auto 40px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }

        .board-title-area { border-bottom: 2px solid #3b82f6; margin-bottom: 20px; padding-bottom: 5px; display: flex; justify-content: space-between; }
        .board-title-input { font-size: 1.5rem; font-weight: bold; color: #1e40af; background: transparent; border: none; outline: none; width: 70%; }

        .setup-bar { display: flex; gap: 15px; margin-bottom: 15px; background: #f9fafb; padding: 10px; border-radius: 8px; align-items: flex-end; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; background: #f3f4f6; padding: 15px; border-radius: 8px; border: 1px solid #d1d5db; }

        .field { display: flex; flex-direction: column; gap: 4px; }
        label { font-size: 0.65rem; font-weight: bold; color: #6b7280; text-transform: uppercase; }
        input { padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.9rem; }

        button { padding: 10px 15px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        .btn-add-piece { background: #10b981; color: white; }
        .btn-new-board { background: #3b82f6; color: white; font-size: 1rem; }
        .btn-delete { background: #ef4444; color: white; padding: 5px 10px; font-size: 0.8rem; }

        .canvas-wrap { margin-top: 20px; background: #111827; padding: 20px; border-radius: 8px; overflow-x: auto; position: relative; }
        .canvas-board-name { color: #60a5fa; font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; border-left: 4px solid #3b82f6; padding-left: 10px; }
        svg { background: white; display: block; margin: 0 auto; outline: 3px solid #000; }

        .stats { margin-top: 10px; font-weight: bold; font-size: 0.9rem; display: flex; justify-content: space-between; }
        .danger { color: #dc2626; }
    </style>
</head>
<body>

<div class="project-header">
    <h1>Project Cut List</h1>
    <button class="btn-new-board" onclick="addNewBoard()">+ Add New Board</button>
</div>

<div id="boards-list"></div>

<script>
    let boardCount = 0;

    function addNewBoard() {
        boardCount++;
        const boardId = `board-${boardCount}`;
        const container = document.createElement('div');
        container.className = 'board-container';
        container.id = boardId;

        container.innerHTML = `
            <div class="board-title-area">
                <input type="text" class="board-title-input" value="BOARD ${boardCount}" placeholder="Board Name..." oninput="updateCanvasTitle('${boardId}')">
                <button class="btn-delete" onclick="document.getElementById('${boardId}').remove()">Delete Board</button>
            </div>

            <div class="setup-bar">
                <div class="field"><label>Stock Width</label><input type="number" class="stockW" value="2400" oninput="renderBoard('${boardId}')"></div>
                <div class="field"><label>Stock Height</label><input type="number" class="stockH" value="260" oninput="renderBoard('${boardId}')"></div>
                <div class="field"><label>Blade Kerf</label><input type="number" class="kerf" value="3" oninput="renderBoard('${boardId}')"></div>
                <button style="background:#6b7280; color:white;" onclick="resetBoard('${boardId}')">Clear Cuts</button>
            </div>

            <div class="controls">
                <div class="field"><label>Cut Name</label><input type="text" class="cutName" value="Piece ${boardCount}"></div>
                <div class="field"><label>Top W</label><input type="number" class="valTop" value="500"></div>
                <div class="field"><label>Bot W</label><input type="number" class="valBot" value="470"></div>
                <div class="field"><label>Height</label><input type="number" class="valHeight" value="260"></div>
                <div class="field"><label>Color</label><input type="color" class="cutColor" value="#3b82f6"></div>
                <button class="btn-add-piece" onclick="addPiece('${boardId}')">Add Piece</button>
            </div>

            <div class="stats">
                <span class="infoText">Remaining: 2400mm</span>
                <span class="kerfText" style="color:#ef4444">Kerf Waste: 0mm</span>
            </div>

            <div class="canvas-wrap">
                <div class="canvas-board-name" id="display-title-${boardId}">BOARD ${boardCount}</div>
                <svg class="mainSvg" width="900" height="150"></svg>
            </div>
        `;

        document.getElementById('boards-list').appendChild(container);
        container.dataset.cuts = JSON.stringify([]);
        renderBoard(boardId);
    }

    function updateCanvasTitle(boardId) {
        const val = document.getElementById(boardId).querySelector('.board-title-input').value;
        document.getElementById(`display-title-${boardId}`).innerText = val.toUpperCase();
    }

    function addPiece(boardId) {
        const board = document.getElementById(boardId);
        const cuts = JSON.parse(board.dataset.cuts);

        const newPiece = {
            name: board.querySelector('.cutName').value,
            top: parseFloat(board.querySelector('.valTop').value),
            bot: parseFloat(board.querySelector('.valBot').value),
            h: parseFloat(board.querySelector('.valHeight').value),
            col: board.querySelector('.cutColor').value
        };

        cuts.push(newPiece);
        board.dataset.cuts = JSON.stringify(cuts);

        // ALL FIELDS REMAIN AS THEY ARE (Sticky behavior)
        renderBoard(boardId);
    }

    function resetBoard(boardId) {
        const board = document.getElementById(boardId);
        board.dataset.cuts = JSON.stringify([]);
        renderBoard(boardId);
    }

    function renderBoard(boardId) {
        const board = document.getElementById(boardId);
        const cuts = JSON.parse(board.dataset.cuts);
        const fullW = parseFloat(board.querySelector('.stockW').value);
        const fullH = parseFloat(board.querySelector('.stockH').value);
        const kerf = parseFloat(board.querySelector('.kerf').value);
        const svg = board.querySelector('.mainSvg');

        const scale = 900 / fullW;
        const visualHeight = fullH * scale;
        svg.setAttribute("height", visualHeight);
        svg.innerHTML = "";

        let curXTop = 0;
        let curXBot = 0;
        let totalKerf = 0;

        cuts.forEach((c, index) => {
            const pieceH = c.h * scale;
            const yOff = (visualHeight - pieceH) / 2;
            const x1 = curXTop * scale;
            const x2 = (curXTop + c.top) * scale;
            const x3 = (curXBot + c.bot) * scale;
            const x4 = curXBot * scale;

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", `M ${x1} ${yOff} L ${x2} ${yOff} L ${x3} ${yOff + pieceH} L ${x4} ${yOff + pieceH} Z`);
            path.setAttribute("fill", c.col);
            path.setAttribute("stroke", "#000");
            svg.appendChild(path);

            const contrast = getContrastYIQ(c.col);
            drawLabel(svg, x1 + (c.top*scale)/2, yOff + (pieceH/2) + 4, c.name, contrast, "11px");
            drawLabel(svg, x1 + (c.top*scale)/2, yOff + 10, c.top, contrast, "9px");
            drawLabel(svg, x4 + (c.bot*scale)/2, yOff + pieceH - 4, c.bot, contrast, "9px");

            curXTop += c.top;
            curXBot += c.bot;

            if (index < cuts.length) {
                const kRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                kRect.setAttribute("x", Math.max(curXTop, curXBot) * scale);
                kRect.setAttribute("y", 0);
                kRect.setAttribute("width", kerf * scale);
                kRect.setAttribute("height", visualHeight);
                kRect.setAttribute("fill", "rgba(239, 68, 68, 0.4)");
                svg.appendChild(kRect);

                curXTop += kerf;
                curXBot += kerf;
                totalKerf += kerf;
            }
        });

        const totalUsed = Math.max(curXTop, curXBot);
        const rem = fullW - totalUsed;
        board.querySelector('.infoText').innerText = `Used: ${totalUsed.toFixed(1)}mm | Remaining: ${rem.toFixed(1)}mm`;
        board.querySelector('.infoText').className = rem < 0 ? "infoText danger" : "infoText";
        board.querySelector('.kerfText').innerText = `Kerf Waste: ${totalKerf.toFixed(1)}mm`;
    }

    function drawLabel(svg, x, y, txt, col, size) {
        const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
        t.setAttribute("x", x); t.setAttribute("y", y);
        t.setAttribute("font-size", size); t.setAttribute("text-anchor", "middle");
        t.setAttribute("fill", col); t.style.fontWeight = "bold";
        t.textContent = txt;
        svg.appendChild(t);
    }

    function getContrastYIQ(hex){
        hex = hex.replace("#", "");
        let r = parseInt(hex.substr(0,2),16), g = parseInt(hex.substr(2,2),16), b = parseInt(hex.substr(4,2),16);
        return ((r*299)+(g*587)+(b*114))/1000 >= 128 ? 'black' : 'white';
    }

    addNewBoard();
</script>
</body>
</html>
